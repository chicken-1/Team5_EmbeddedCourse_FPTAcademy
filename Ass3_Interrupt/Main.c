/*******************************************************************************
* Include
*******************************************************************************/
#include "Interrupt.h"

/*******************************************************************************
* Definitions
*******************************************************************************/
static mode current_mode = STOP_MODE;

/*******************************************************************************
* Prototypes
*******************************************************************************/
void PORTBCD_IRQHandler(void);

void SysTick_Handler(void);

/*******************************************************************************
* Main
*******************************************************************************/
int main() {
	Init_GREEN_LED();
	InitSW3();
	SysTick_Config(19200); /* 19200 ticks = 400us */

	while(1) {

	}
}

/*******************************************************************************
* Functions
*******************************************************************************/
void PORTBCD_IRQHandler() {
	// Clear ISF flag
	PORTD->PCR[2] |= 1 << 24;

	// mode conversion
	if (current_mode == STOP_MODE) {
		current_mode = MODE1;
	}
	else if (current_mode == MODE1) {
		current_mode = MODE2;
	}
	else if (current_mode == MODE2) {
		current_mode = MODE3;
	}
	else {
		current_mode = STOP_MODE;
	}
}

void SysTick_Handler() {
	if (current_mode == MODE1) {
		mode1();
	}
	else if (current_mode == MODE2) {
		mode2();
	}
	else if (current_mode == MODE3) {
		mode3();
	}
	else {
		stop_mode();
	}
}

/*******************************************************************************
* EOF
*******************************************************************************/
